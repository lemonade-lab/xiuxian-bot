import { APlugin, Controllers, type AEvent } from 'alemonjs'
import {
  DB,
  isThereAUserPresent,
  isThereAUserPresentB,
  GameApi,
  dualVerification,
  dualVerificationAction,
  victoryCooling,
  postHelp
} from '../../api/index.js'
import { QQ_GROUP } from '../../model/config/index.js'
export class ControllLevel extends APlugin {
  constructor() {
    super({
      rule: [
        { reg: /^(#|\/)?(ä¼ åŠŸ|å‚³åŠŸ).*$/, fnc: 'transmissionPower' },
        { reg: /^(#|\/)?(é›™ä¿®|åŒä¿®).*$/, fnc: 'ambiguous' }
      ]
    })
  }

  /**
   * åŒä¿®
   * @param e
   * @returns
   */
  async ambiguous(e: AEvent) {
    const UID = e.user_id
    if (e.platform == 'ntqq') {
      Controllers(e).Message.reply('', [
        {
          label: 'åŠ å…¥å®˜ç¾¤',
          link: QQ_GROUP
        }
      ])
    }
    if (!(await isThereAUserPresent(e, UID))) return
    const UserData = await GameApi.Users.read(UID)
    const UIDB = e?.at_user?.id || e.msg.replace(/^(#|\/)?(é›™ä¿®|åŒä¿®)*/, '')
    if (!UIDB) return
    if (!(await isThereAUserPresentB(e, UIDB))) return
    const UserDataB = await GameApi.Users.read(UIDB)
    if (!(await dualVerification(e, UserData, UserDataB))) return
    if (UserData.special_spiritual < 5) {
      e.reply(['çµåŠ›ä¸è¶³'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    if (UserDataB.special_spiritual < 5) {
      e.reply(['çµåŠ›ä¸è¶³'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    if (!dualVerificationAction(e, UserData.point_type, UserDataB.point_type))
      return

    const CDID = 20,
      CDTime = GameApi.Cooling.CD_transmissionPower
    if (!(await victoryCooling(e, UID, CDID))) return

    GameApi.Burial.set(UID, CDID, CDTime)

    // è¯»å–å¢ƒç•Œ
    const LevelDataA = await GameApi.Levels.read(UID, 1),
      LevelDataB = await GameApi.Levels.read(UIDB, 1)
    const sizeA = LevelDataA.experience * 0.15,
      sizeB = LevelDataB.experience * 0.1
    const expA = sizeA > 648 ? 648 : sizeA,
      expB = sizeB > 648 ? 648 : sizeB

    await GameApi.Users.update(UID, {
      special_spiritual: UserData.special_spiritual - 5
    } as DB.UserType)
    await GameApi.Users.update(UIDB, {
      special_spiritual: UserDataB.special_spiritual - 5
    } as DB.UserType)

    const exA = Math.floor((expA * (UserData.talent_size + 100)) / 100),
      exB = Math.floor((expB * (UserDataB.talent_size + 100)) / 100)
    const eA = exA < 3280 ? exA : 3280,
      eB = exB < 3280 ? exB : 3280

    await GameApi.Levels.addExperience(UID, 1, eA)
    await GameApi.Levels.addExperience(UIDB, 1, eB)

    e.reply(
      [
        'â¤ï¸',

        'æƒ…æŠ•æ„åˆ~\n',

        `ä½ æ¿€åŠ¨çš„ä¿®ä¸ºå¢åŠ äº†${eA}~\n`,

        `å¯¹æ–¹å¥‡æ€ªçš„ä¿®ä¸ºå¢åŠ äº†${eB}`
      ],
      {
        quote: e.msg_id
      }
    )
    postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

    return
  }

  /**
   * ä¼ åŠŸ
   * @param e
   * @returns
   */
  async transmissionPower(e: AEvent) {
    const UID = e.user_id
    if (!(await isThereAUserPresent(e, UID))) return
    const UserData = await GameApi.Users.read(UID)
    const UIDB = e?.at_user?.id || e.msg.replace(/^(#|\/)?(ä¼ åŠŸ|å‚³åŠŸ)*/, '')
    if (!UIDB) return
    if (!(await isThereAUserPresentB(e, UIDB))) return
    const UserDataB = await GameApi.Users.read(UIDB)
    if (!(await dualVerification(e, UserData, UserDataB))) return

    if (UserData.special_spiritual < 5) {
      e.reply(['çµåŠ›ä¸è¶³'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    if (UserDataB.special_spiritual < 5) {
      e.reply(['çµåŠ›ä¸è¶³'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    if (!dualVerificationAction(e, UserData.point_type, UserDataB.point_type))
      return
    const LevelDataA = await GameApi.Levels.read(UID, 1),
      LevelDataB = await GameApi.Levels.read(UIDB, 1)
    if (!LevelDataA || !LevelDataB) return
    if (LevelDataA.realm < 21) {
      e.reply(['æœªåˆ°å…ƒå©´æœŸ'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    if (LevelDataA.experience <= 2000) {
      e.reply(['æ‰€å‰©ä¿®ä¸ºä½äº2000'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    // Bçš„å¢ƒç•Œç›¸å·®
    const LevelSize = 9
    if (
      LevelDataB.realm < LevelDataA.realm - LevelSize ||
      LevelDataB.realm > LevelDataA.realm + LevelSize
    ) {
      e.reply(['ä¸', 'æœ€å¤šå¯ç›¸å·®9ä¸ªå¢ƒç•Œ'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }

    await GameApi.Users.update(UID, {
      special_spiritual: UserData.special_spiritual - 5
    } as DB.UserType)
    await GameApi.Users.update(UIDB, {
      special_spiritual: UserDataB.special_spiritual - 5
    } as DB.UserType)

    if (!GameApi.Method.isTrueInRange(1, 100, 85)) {
      // æ¸…ç©ºç»éªŒ
      await GameApi.Levels.reduceExperience(UID, 1, LevelDataA.experience)
      // æ‰å¢ƒç•Œ
      await GameApi.Levels.fallingRealm(UID, 1)
      e.reply(['ğŸ¤ªä¼ åŠŸå¤±è´¥äº†', 'æ‰è½äº†ä¸€ä¸ªå¢ƒç•Œï¼'], {
        quote: e.msg_id
      })
      postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

      return
    }
    // æ¸…ç©ºç»éªŒ
    await GameApi.Levels.reduceExperience(UID, 1, LevelDataA.experience)
    // å¢åŠ å¯¹æ–¹ç»éªŒ
    const size = Math.floor(LevelDataA.experience * 0.6)
    await GameApi.Levels.addExperience(UIDB, 1, size)
    e.reply(['æˆåŠŸä¼ ', `[ä¿®ä¸º]*${size}ç»™`, UIDB], {
      quote: e.msg_id
    })
    postHelp(e,"[{\"group\":\"æˆ˜æ–—\",\"list\":[{\"icon\":21,\"title\":\"/æ‰“åŠ«@é“å‹\",\"desc\":\"è‹¥åœ¨åŸé‡Œéœ€å†³æ–—ä»¤\"},{\"icon\":39,\"title\":\"/å‡»æ€+æ€ªç‰©å\",\"desc\":\"éšæœºæ‰è½ç‰©å“\"},{\"icon\":68,\"title\":\"/æ¢ç´¢æ€ªç‰©\",\"desc\":\"æŸ¥çœ‹æ‰€åœ¨åœ°çš„æ€ªç‰©\"},{\"icon\":68,\"title\":\"/æˆ˜æ–—è¿‡ç¨‹(å¼€å¯|å…³é—­)\",\"desc\":\"é»˜è®¤å…³é—­æˆ˜æ–—è¿‡ç¨‹\"},{\"icon\":68,\"title\":\"/æŒ‘æˆ˜å¦–å¡”\",\"desc\":\"åˆ·å–æ¸¡åŠ«ææ–™\"}]},{\"group\":\"æå‡æˆ˜åŠ›\",\"list\":[{\"icon\":14,\"title\":\"/é—­å…³\",\"desc\":\"è¿›è¡Œé—­å…³\"},{\"icon\":14,\"title\":\"/å‡ºå…³\",\"desc\":\"å¢åŠ ä¿®ä¸º\"},{\"icon\":21,\"title\":\"/é”»ä½“\",\"desc\":\"è¿›è¡Œé”»ä½“\"},{\"icon\":21,\"title\":\"/å‡è„‰\",\"desc\":\"é”»ç‚¼æ°”è¡€\"},{\"icon\":21,\"title\":\"/æ‰“å\",\"desc\":\"èšé›†çµæ°”\"},{\"icon\":21,\"title\":\"/èšçµ\",\"desc\":\"å‡èšä½“å†…\"},{\"icon\":8,\"title\":\"/ç‚¼åŒ–+ç‰©å“å\",\"desc\":\"ç‚¼åŒ–ç‰©å“æœªæœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/ç²¾ç‚¼\",\"desc\":\"å¼ºåŒ–æœ¬å‘½ç‰©\"},{\"icon\":8,\"title\":\"/çªç ´\",\"desc\":\"ç»ƒæ°”å‡çº§\"},{\"icon\":8,\"title\":\"/ç ´å¢ƒ\",\"desc\":\"ç»ƒä½“å‡çº§\"}]},{\"group\":\"å…¶å®ƒ\",\"list\":[{\"icon\":16,\"title\":\"/æˆ˜æ–—å¸®åŠ©\",\"desc\":\"æˆ˜æ–—ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åœ°å›¾å¸®åŠ©\",\"desc\":\"åœ°å›¾ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/è”ç›Ÿå¸®åŠ©\",\"desc\":\"è”ç›Ÿç³»ç»Ÿ\"},{\"icon\":8,\"title\":\"/é»‘å¸‚å¸®åŠ©\",\"desc\":\"äº¤æ˜“ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/ä¿®ç‚¼å¸®åŠ©\",\"desc\":\"ä¿®ç‚¼ç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/èŒä¸šå¸®åŠ©\",\"desc\":\"èŒä¸šç³»ç»Ÿ\"},{\"icon\":16,\"title\":\"/åŠ¿åŠ›å¸®åŠ©\",\"desc\":\"åŠ¿åŠ›ç³»ç»Ÿ\"}]}]")

    return
  }
}
